<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Tạo mã QR cho bàn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { font-size: 16px; padding: 6px; margin: 4px 0; }
    #qrcode canvas { margin-top: 12px; }
  </style>
</head>
<body>
  <h2>Tạo mã QR</h2>
  <label>Nhập số bàn: </label>
  <input id="table" value="T01" placeholder="VD: T05" />
  <button id="make">Tạo QR</button>
  <div id="qrcode"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const qrDiv = document.getElementById("qrcode");
    const makeBtn = document.getElementById("make");

    makeBtn.onclick = async () => {
      const table = document.getElementById("table").value.trim() || "T01";
      const localIp = await fetch("https://api.ipify.org?format=json")
        .then(r => r.json())
        .then(d => d.ip)
        .catch(() => "localhost");

      const port = window.location.port || "4000";
      const base = `http://${localIp}:${port}/order.html`;
      const url = `${base}?table=${encodeURIComponent(table)}`;

      qrDiv.innerHTML = "";
      new QRCode(qrDiv, {
        text: url,
        width: 200,
        height: 200
      });

      console.log("✅ QR chứa:", url);
    };
  </script>
</body>
</html>
